!function(e){var t=null,a={},o=[],i=[],d=e("html"),n=e("body"),c=e(window),l=function(){if(o.length||i.length){var e=o.length?o[o.length-1]:i[i.length-1],l=c.width(),s=c.height(),r=a[e].config.height,g=r,m=a[e].config.width,f=0,h=!1,p=!1;if(t&&d.addClass("has-caldera-modal"),f=(s-a[e].config.height)/2.2,0>f&&(f=0),r+2*a[e].config.padding>s&&t&&(r=s-2*a[e].config.padding,g="100%",t&&t.css({paddingTop:a[e].config.padding,paddingBottom:a[e].config.padding}),p=!0),m+2*a[e].config.padding>=l&&(m="100%",t&&t.css({paddingLeft:a[e].config.padding,paddingRight:a[e].config.padding}),p=!0),!0===p&&(700>=l&&l>600?(t&&(r=s-2*a[e].config.padding),m=l,g=r-2*a[e].config.padding,m="100%",f=0,t&&t.css({padding:a[e].config.padding})):600>=l&&(t&&(r=s),m=l,g="100%",f=0,t&&t.css({padding:0}))),t&&t.is(":hidden")&&(h=!0,t.show()),a[e].header&&(t&&t.show(),r-=a[e].header.outerHeight(),a[e].closer.css({padding:a[e].header.outerHeight()/2-.5}),a[e].title.css({paddingRight:a[e].closer.outerWidth()})),a[e].footer&&(t&&t.show(),r-=a[e].footer.outerHeight()),t&&h===!0&&(t.hide(),h=!1),r!=g&&a[e].body.css({height:r}),a[e].modal.css({width:m}),a[e].config.sticky&&a[e].config.minimized){var u={},y=a[e].title.outerHeight()-a[e].modal.outerHeight();a[e].config.sticky.indexOf("bottom")>-1?u["margin-bottom"]=y:a[e].config.sticky.indexOf("top")>-1&&(u["margin-top"]=y),a[e].modal.css(u),a[e].config.sticky.length>=3&&(n.css("margin-"+a[e].config.sticky[0],a[e].title.outerHeight()),p?a[e].modal.css(a[e].config.sticky[1],0):a[e].modal.css(a[e].config.sticky[1],parseFloat(a[e].config.sticky[2])))}return t&&(a[e].modal.css({marginTop:f,height:g}),setTimeout(function(){a[e].modal.addClass("caldera-animate")},10),t.fadeIn(a[e].config.speed)),a}},s=function(i){var n=e(i).data("modal"),c=0,l={};if(i&&a[n].config.sticky)return a[n].config.minimized?(a[n].config.minimized=!1,c=0):(a[n].config.minimized=!0,c=a[n].title.outerHeight()-a[n].modal.outerHeight()),a[n].config.sticky.indexOf("bottom")>-1?l["margin-bottom"]=c:a[n].config.sticky.indexOf("top")>-1&&(l["margin-top"]=c),void a[n].modal.stop().animate(l,a[n].config.speed);var s;o.length&&(s=o.pop(),a[s].modal.hasClass("caldera-animate")&&!o.length?(a[s].modal.removeClass("caldera-animate"),setTimeout(function(){a[s].modal.remove(),delete a[s]},500)):t&&a[s].modal.hide(0,function(){e(this).remove(),delete a[s]})),o.length?a[o[o.length-1]].modal.show():(t&&t.fadeOut(250,function(){e(this).remove(),t=null}),d.removeClass("has-caldera-modal"))};e.calderaModal=function(d){var c=e.extend(!0,{element:"div",height:550,width:620,padding:12,speed:250},d);t||c.sticky||(t=e("<div>",{"class":"caldera-backdrop"}),c.focus||t.on("click",function(e){e.target==this&&s()}),n.append(t),t.hide());var r=c.element,g=c.modal;if(o.length&&o[o.length-1]!==g&&a[o[o.length-1]].modal.hide(),"undefined"==typeof a[g]?(c.sticky&&(c.sticky=c.sticky.split(" "),c.sticky.length<2&&(c.sticky=null),i.push(g)),a[g]={config:c,modal:e("<"+r+">",{id:g+"_calderaModal",tabIndex:-1,"ariaLabelled-by":g+"_calderaModalLable","class":"caldera-modal-wrap"+(c.sticky?" caldera-sticky-modal "+c.sticky[0]+"-"+c.sticky[1]:"")})},c.sticky||o.push(g)):(a[g].config=c,a[g].modal.empty()),c.animate&&t){var m=c.animate.split(" "),f=c.speed+"ms",h=c.animateEase?c.animateEase:"ease";1===m.length&&(m[1]=0),a[g].modal.css({transform:"translate("+m[0]+", "+m[1]+")","-web-kit-transition":"transform "+f+" "+h,"-moz-transition":"transform "+f+" "+h,transition:"transform "+f+" "+h})}if(a[g].body=e("<div>",{"class":"caldera-modal-body",id:g+"_calderaModalBody"}),a[g].content=e("<div>",{"class":"caldera-modal-content",id:g+"_calderaModalContent"}),a[g].content.css({margin:c.padding}),a[g].body.append(a[g].content).appendTo(a[g].modal),t?t.append(a[g].modal):a[g].modal.appendTo(e("body")),c.footer)if(a[g].footer=e("<div>",{"class":"caldera-modal-footer",id:g+"_calderaModalFooter"}),a[g].footer.css({padding:c.padding}),a[g].footer.appendTo(a[g].modal),"function"==typeof window[c.footer])a[g].footer.append(window[c.footer](d,this));else if("string"==typeof c.footer)try{var p=e(c.footer);a[g].footer.html(p.html())}catch(u){a[g].footer.html(c.footer)}if(c.title){var y="prependTo";a[g].header=e("<div>",{"class":"caldera-modal-title",id:g+"_calderaModalTitle"}),a[g].closer=e("<a>",{href:"#close","class":"caldera-modal-closer","data-dismiss":"modal","aria-hidden":"true",id:g+"_calderaModalCloser"}).html("&times;"),a[g].title=e("<h3>",{"class":"modal-label",id:g+"_calderaModalLable"}),a[g].title.html(c.title).appendTo(a[g].header),a[g].title.css({padding:c.padding}),a[g].title.append(a[g].closer),a[g].config.sticky?(a[g].config.minimized&&!0!==a[g].config.minimized&&(setTimeout(function(){a[g].title.trigger("click")},parseInt(a[g].config.minimized)),a[g].config.minimized=!1),a[g].closer.hide(),a[g].title.addClass("caldera-modal-closer").data("modal",g).appendTo(a[g].header),a[g].config.sticky.indexOf("top")>-1&&(y="appendTo")):a[g].closer.data("modal",g).appendTo(a[g].header),a[g].header[y](a[g].modal)}if(a[g].modal.outerHeight(c.height),a[g].modal.outerWidth(c.width),c.content)if("function"==typeof c.content)a[g].content.append(c.content(d,a[g],this));else if("function"==typeof window[c.content])a[g].content.append(window[c.content](d,a[g],this));else if("string"==typeof c.content)try{var w=e(c.content);w.length?(a[g].content.append(w.detach()),w.show()):a[g].content.html(c.content)}catch(u){a[g].content.html(c.content)}return l(),a[g]},e.fn.calderaModal=function(t){return t||(t={}),t=e.extend({},this.data(),t),e.calderaModal(t)},window.addEventListener?(window.addEventListener("resize",l,!1),window.addEventListener("keypress",function(e){27===e.keyCode&&null!==t&&t.trigger("click")},!1)):window.attachEvent?window.attachEvent("onresize",l):window.onresize=l,e(document).on("click","[data-modal]:not(.caldera-modal-closer)",function(t){t.preventDefault(),e(this).calderaModal()}),e(window).load(function(){e("[data-modal][data-autoload]").each(function(){e(this).calderaModal()})}),e(document).on("click",".caldera-modal-closer",function(e){e.preventDefault(),s(this)})}(jQuery);